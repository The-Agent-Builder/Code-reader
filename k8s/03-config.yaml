# 前端 Nginx 配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: code-reader-frontend-nginx-config
  namespace: code-reader
  labels:
    app: code-reader
    component: frontend-nginx-config
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        
        # 前端静态文件
        location / {
            root /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ /index.html;
        }
        
        # API 反向代理到后端服务
        location /api/ {
            proxy_pass http://code-reader-backend-service:8000/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
        }
    }
---
# 测试环境前端 Nginx 配置
apiVersion: v1
kind: ConfigMap
metadata:
  name: code-reader-frontend-nginx-config-test
  namespace: code-reader
  labels:
    app: code-reader
    component: frontend-nginx-config
    environment: test
data:
  default.conf: |
    server {
        listen 80;
        server_name localhost;
        
        # 前端静态文件
        location / {
            root /usr/share/nginx/html;
            index index.html;
            try_files $uri $uri/ /index.html;
        }
        
        # API 反向代理到后端服务
        location /api/ {
            proxy_pass http://code-reader-backend-service-test:8000/;
            proxy_http_version 1.1;
            proxy_set_header Upgrade $http_upgrade;
            proxy_set_header Connection 'upgrade';
            proxy_set_header Host $host;
            proxy_set_header X-Real-IP $remote_addr;
            proxy_set_header X-Forwarded-For $proxy_add_x_forwarded_for;
            proxy_set_header X-Forwarded-Proto $scheme;
            proxy_cache_bypass $http_upgrade;
        }
    }
---
# 生产环境后端 ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: code-reader-backend-config
  namespace: code-reader
  labels:
    app: code-reader
    component: backend-config
data:
  .env: |
    # Code Reader 后端生产环境配置
    
    # GitHub 配置
    GITHUB_TOKEN=
    
    # OpenAI/LLM 配置
    OPENAI_API_KEY=
    OPENAI_BASE_URL=
    OPENAI_MODEL=gpt-3.5-turbo
    
    # RAG 配置
    RAG_BASE_URL=
    RAG_BATCH_SIZE=100
    
    # README API 配置（外部文档生成服务）
    README_API_BASE_URL=
    
    # 数据库配置
    DB_HOST=
    DB_PORT=3306
    DB_NAME=code_analysis
    DB_USER=
    DB_PASSWORD=
    
    # 应用配置
    APP_HOST=0.0.0.0
    APP_PORT=8000
    
    # 存储路径
    LOCAL_REPO_PATH=/app/data/repos
    RESULTS_PATH=/app/data/results
    VECTORSTORE_PATH=/app/data/vectorstores
---
# 测试环境后端 ConfigMap
apiVersion: v1
kind: ConfigMap
metadata:
  name: code-reader-backend-config-test
  namespace: code-reader
  labels:
    app: code-reader
    component: backend-config
    environment: test
data:
  .env: |
    # Code Reader 后端测试环境配置
    
    # GitHub 配置
    GITHUB_TOKEN=
    
    # OpenAI/LLM 配置
    OPENAI_API_KEY=
    OPENAI_BASE_URL=
    OPENAI_MODEL=gpt-3.5-turbo
    
    # RAG 配置
    RAG_BASE_URL=
    RAG_BATCH_SIZE=100
    
    # README API 配置（外部文档生成服务）
    README_API_BASE_URL=
    
    # 数据库配置
    DB_HOST=
    DB_PORT=3306
    DB_NAME=code_analysis_test
    DB_USER=
    DB_PASSWORD=
    
    # 应用配置
    APP_HOST=0.0.0.0
    APP_PORT=8000
    
    # 存储路径
    LOCAL_REPO_PATH=/app/data/repos
    RESULTS_PATH=/app/data/results
    VECTORSTORE_PATH=/app/data/vectorstores
