<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>前端显示测试</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet">
</head>
<body>
    <div class="container mt-4">
        <h2>前端显示测试</h2>
        
        <div class="card">
            <div class="card-body">
                <h5>进度显示测试</h5>
                
                <div class="progress mb-2">
                    <div class="progress-bar progress-bar-striped progress-bar-animated" 
                         role="progressbar" id="progressBar" style="width: 0%">
                        <span id="progressText">0%</span>
                    </div>
                </div>
                
                <div class="file-info">
                    <div class="row">
                        <div class="col-md-6">
                            <i class="fas fa-file-code me-1"></i>
                            <span id="fileProgress">0 / 0 文件</span>
                        </div>
                        <div class="col-md-6">
                            <i class="fas fa-clock me-1"></i>
                            <span id="timeElapsed">00:00</span>
                        </div>
                    </div>
                    <div class="mt-2">
                        <i class="fas fa-file me-1"></i>
                        当前文件: <span id="currentFile">-</span>
                    </div>
                    <div class="mt-1">
                        <i class="fas fa-info-circle me-1"></i>
                        状态: <span id="statusMessage">准备中...</span>
                    </div>
                </div>
                
                <div class="mt-3">
                    <button class="btn btn-primary" onclick="testUpdate()">测试更新</button>
                    <button class="btn btn-secondary" onclick="testReset()">重置</button>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let startTime = new Date();
        
        function testUpdate() {
            console.log("测试更新开始");
            
            // 模拟状态数据
            const status = {
                progress: 0.5,
                total_files: 7,
                completed_files: 3,
                current_file: "test.py",
                message: "分析中: test.py"
            };
            
            updateProgress(status);
        }
        
        function testReset() {
            console.log("重置显示");
            
            document.getElementById("progressBar").style.width = "0%";
            document.getElementById("progressText").textContent = "0%";
            document.getElementById("fileProgress").textContent = "0 / 0 文件";
            document.getElementById("timeElapsed").textContent = "00:00";
            document.getElementById("currentFile").textContent = "-";
            document.getElementById("statusMessage").textContent = "准备中...";
            
            startTime = new Date();
        }
        
        function updateProgress(status) {
            console.log("updateProgress called with:", status);
            
            const progress = (status.progress || 0) * 100;
            const progressBar = document.getElementById("progressBar");
            const progressText = document.getElementById("progressText");
            
            // 更新进度条
            progressBar.style.width = progress + "%";
            progressText.textContent = Math.round(progress) + "%";
            
            // 更新文件进度
            const totalFiles = status.total_files || 0;
            const completedFiles = status.completed_files || 0;
            
            console.log("File progress:", completedFiles, "/", totalFiles);
            
            if (totalFiles > 0) {
                const fileProgressText = `${completedFiles} / ${totalFiles} 文件`;
                console.log("Setting fileProgress to:", fileProgressText);
                document.getElementById("fileProgress").textContent = fileProgressText;
            } else {
                const fileProgressText = `${completedFiles} 文件`;
                console.log("Setting fileProgress to:", fileProgressText);
                document.getElementById("fileProgress").textContent = fileProgressText;
            }
            
            // 更新当前文件
            if (status.current_file && status.current_file !== "null") {
                const fileName = status.current_file.split("/").pop() || status.current_file;
                document.getElementById("currentFile").textContent = fileName;
            } else {
                document.getElementById("currentFile").textContent = "准备中...";
            }
            
            // 更新状态消息
            if (status.message) {
                document.getElementById("statusMessage").textContent = status.message;
            }
            
            // 更新时间
            if (startTime) {
                const elapsed = Math.floor((new Date() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById("timeElapsed").textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            }
        }
        
        // 每秒更新时间
        setInterval(() => {
            if (startTime) {
                const elapsed = Math.floor((new Date() - startTime) / 1000);
                const minutes = Math.floor(elapsed / 60);
                const seconds = elapsed % 60;
                document.getElementById("timeElapsed").textContent = `${minutes.toString().padStart(2, "0")}:${seconds.toString().padStart(2, "0")}`;
            }
        }, 1000);
    </script>
</body>
</html>